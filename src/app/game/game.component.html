<div class="container">
  <br>
  <div class="block">
    <h1 class="title is-1 has-text-centered">ğŸ­ Chirrins' Charadas ğŸ‰</h1>
  </div>
  <div *ngIf="!gameStarted" class="section">
    <div class="columns is-variable is-5">
      <div class="column">
        <div class="box">
          <div [formGroup]="form" class="has-text-centered">
            <div class="field">
              <label class="label">Ingresa nombre de una pareja</label>
              <input class="input" (keydown.enter)="addCouple()" formControlName="coupleName"
                     placeholder="E.g., Pedro y Ana, Samuel y Paola">
            </div>
            <div class="block has-text-centered">
              <button type="submit" class="button is-success is-large" (click)="addCouple()">â• AÃ±adir
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="box">
          <div class="block has-text-centered">
            <h2 class="title is-4">Participantes</h2>
            <div class="content" *ngIf="startingCouples.length > 0">
              <div *ngFor="let couple of startingCouples" class="participant-item">
                <span class="participant-name">{{ couple.name }}</span>
                <div class="participant-actions">
                  <button class="button is-small is-info" (click)="editCouple(couple)">âœï¸</button>
                  <button class="button is-small is-danger" (click)="deleteCouple(couple.id)">ğŸ—‘ï¸</button>
                </div>
              </div>
            </div>
            <p *ngIf="startingCouples.length === 0" class="has-text-grey">No hay parejas inscritas</p>
          </div>
          <div class="buttons block is-centered">
            <button class="button is-success is-large" [disabled]="startingCouples.length <= 1" (click)="startGame()">ğŸ® Empezar a
              Jugar
            </button>
            <button class="button is-danger" [disabled]="startingCouples.length <= 1" (click)="reset()">ğŸ”„ Reiniciar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="gameStarted" class="section">
    <div *ngIf="!hasSelectedCategory" class="box has-text-centered">
      <div class="field">
        <label class="label">ğŸ“‹ Selecciona una CategorÃ­a:</label>
        <div class="control">
          <select class="custom-select" [(ngModel)]="selectedCategory">
            <option value='' disabled selected>Seleccione una categorÃ­a</option>
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
        </div>
      </div>
      <br>
      <button class="button is-info is-large" (click)="loadWords()" [disabled]="!selectedCategory">â–¶ï¸ Siguiente</button>
    </div>

    <div *ngIf="currentCouple && !roundEnded" class="box has-text-centered">
      <h2 *ngIf="!isCouplePlaying" class="title is-2">Pareja <span
        class="has-text-primary">{{currentCouple.name}}</span>, les toca jugar</h2>
      <h3 class="title is-3" *ngIf="isCouplePlaying">Jugando: <span
        class="has-text-primary">{{currentCouple.name}}</span></h3>
      <h4 class="subtitle is-4">CategorÃ­a: <span class="has-text-warning"> {{ selectedCategory }} </span></h4>
      <br>
      <h2 class="title is-2">Puntaje: <span class="has-text-success">{{ currentCouple.score }}</span></h2>
      <div class="buttons block is-centered">
        <button [disabled]="isCouplePlaying || isPaused" class="button is-warning is-large" (click)="startRound()">ğŸš€ Comenzar</button>
        <button *ngIf="isCouplePlaying && !isPaused" class="button is-warning is-large" (click)="pauseGame()">â¸ï¸ Pausar</button>
        <button *ngIf="isCouplePlaying && isPaused" class="button is-info is-large" (click)="resumeGame()">â–¶ï¸ Reanudar</button>
        <button *ngIf="isCouplePlaying" class="button is-danger is-large" (click)="resetGame()">ğŸ”„ Reiniciar</button>
      </div>
    </div>

    <div *ngIf="isCouplePlaying" class="box has-text-centered">
      <h4 class="subtitle is-4">â±ï¸ Tiempo Disponible: {{ timer$ | async | date:'mm:ss' }} </h4>
      <div class="block notification is-primary">
        <h2 class="title is-2 is-capitalized"> {{ isPaused ? 'â¸ï¸ PAUSADO' : words[0] }} </h2>
      </div>
      <div class="buttons block is-centered">
        <button class="button is-success" (click)="correctWord()" [disabled]="isPaused">âœ… Correcto</button>
        <button class="button is-danger" (click)="passWord()" [disabled]="isPaused">â¡ï¸ Siguiente</button>
      </div>
    </div>

    <div *ngIf="roundEnded" class="box">
      <div *ngIf="winner" class="has-text-centered winner-container">
        <!-- Elementos de confeti -->
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        <div class="confetti"></div>
        
        <!-- Elementos de fuegos artificiales -->
        <div class="firework"></div>
        <div class="firework"></div>
        <div class="firework"></div>
        <div class="firework"></div>
        
        <h2 class="title is-2 winner-title">ğŸŠÂ¡Tenemos un ganador!ğŸŠ</h2>
        <h3 class="title is-4 winner-name">La pareja ganadora fue: {{ winner.name }}</h3>
        <h4 class="subtitle is-5 winner-score">Puntaje: {{ winner.score }} </h4>
      </div>

      <div *ngIf="hasATie" class="has-text-centered">
        <h2 class="title is-2">Â¡Ha habido un empate!</h2>
      </div>

      <div class="scores-section">
        <h3 class="title is-4 scores-title">ğŸ† Tabla de Puntajes ğŸ†</h3>
        <div class="scores-list">
          <div *ngFor="let couple of endingCouples; let i = index" class="score-item">
            <div class="score-rank">
              <span class="rank-number" [class.gold]="i === 0" [class.silver]="i === 1" [class.bronze]="i === 2">
                {{ i + 1 }}
              </span>
            </div>
            <div class="score-info">
              <span class="couple-name">{{ couple.name }}</span>
              <span class="couple-score">{{ couple.score }} pts</span>
            </div>
          </div>
        </div>
      </div>
      <div class="has-text-centered">
        <button class="button is-primary is-large" (click)="restartGame()">ğŸ” Volver a Jugar</button>
      </div>
    </div>
  </div>
</div>
